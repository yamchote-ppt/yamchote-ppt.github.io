<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>819605 Quiz System | Discrete Mathematics | Southeast Asia University</title>
    <meta name="description" content="‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏ä‡∏≤‡∏ß‡∏¥‡∏¢‡∏∏‡∏ï‡∏Ñ‡∏ì‡∏¥‡∏ï 819605"/>
    <meta name="keywords" content="Discrete Mathematics Quiz, ‡∏ß‡∏¥‡∏¢‡∏∏‡∏ï‡∏Ñ‡∏ì‡∏¥‡∏ï, ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå, Southeast Asia University" />

    <!-- External Stylesheets -->
    <link rel="stylesheet" href="assets/css/quiz-system.css">

    <!-- Configuration -->
    <script src="assets/js/quiz-config.js"></script>

    <!-- Page-specific styles (if needed) -->
    <style>
        /* Add any page-specific style overrides here */
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="top-nav">
        <div class="nav-container">
            <a href="819605-2-2568.html" class="nav-brand">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <h1>üìê ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
        <p class="hero-subtitle">819605 - Discrete Mathematics</p>
    </section>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Quiz Start Screen -->
        <div id="quizStart" class="quiz-start">
            <h2>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h2>
            
            <div class="alert alert-warning">
                <span style="font-size: 1.5rem;">‚ö†Ô∏è</span>
                <div>
                    <strong>‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç - ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö:</strong>
                    <ul style="margin: 0.5rem 0 0 1.5rem; line-height: 1.8;">
                        <li><strong>‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå</strong> ‡∏Ç‡∏ì‡∏∞‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</li>
                        <li><strong>‡∏´‡πâ‡∏≤‡∏°‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏õ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏∑‡πà‡∏ô</strong> ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏à‡∏≠‡∏†‡∏≤‡∏û</li>
                        <li><strong>‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ Alt+Tab ‡∏´‡∏£‡∏∑‡∏≠ Windows+Tab</strong> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°</li>
                        <li><strong>‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏õ‡∏¥‡∏î Developer Tools</strong> (F12) ‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏π‡∏ã‡∏≠‡∏£‡πå‡∏™‡πÇ‡∏Ñ‡πâ‡∏î</li>
                        <li><strong>‡∏´‡πâ‡∏≤‡∏° Copy/Paste</strong> ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å‡πÅ‡∏´‡∏•‡πà‡∏á‡∏≠‡∏∑‡πà‡∏ô</li>
                        <li><strong style="color: var(--danger);">‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡πÄ‡∏°‡∏¥‡∏î‡∏Å‡∏é 2 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!</strong></li>
                    </ul>
                </div>
            </div>

            <div class="alert alert-info">
                <span style="font-size: 1.5rem;">‚ÑπÔ∏è</span>
                <div>
                    <strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏°‡∏µ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≥‡∏Å‡∏±‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ
                </div>
            </div>

            <div class="quiz-info">
                <div class="quiz-info-item">
                    <span class="icon">üìù</span>
                    <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠:</strong>
                    <span id="totalQuestions">-</span> ‡∏Ç‡πâ‡∏≠
                </div>
                <div class="quiz-info-item">
                    <span class="icon">‚è±Ô∏è</span>
                    <strong>‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö:</strong>
                    <span id="quizDuration">-</span> ‡∏ô‡∏≤‡∏ó‡∏µ
                </div>
                <div class="quiz-info-item">
                    <span class="icon">üéØ</span>
                    <strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏ï‡πá‡∏°:</strong>
                    <span id="totalPoints">-</span> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
                </div>
                <div class="quiz-info-item">
                    <span class="icon">üìä</span>
                    <strong>‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ú‡πà‡∏≤‡∏ô:</strong>
                    60%
                </div>
            </div>

            <form class="student-info-form" id="studentForm">
                <div class="form-group">
                    <label for="studentId">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ *</label>
                    <input type="text" id="studentId" required placeholder="‡πÄ‡∏ä‡πà‡∏ô 6501234567">
                </div>
                <div class="form-group">
                    <label for="studentName">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                    <input type="text" id="studentName" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
                </div>
                <div class="form-group">
                    <label for="quizSelect">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö *</label>
                    <select id="quizSelect" required>
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö --</option>
                        <option value="quiz1">Quiz 1: Set Theory & Logic</option>
                        <option value="quiz2">Quiz 2: Functions & Relations</option>
                        <option value="midterm">Midterm Exam</option>
                        <option value="final">Final Exam</option>
                        <option value="demo">Demo Quiz (‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö)</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
            </form>
        </div>

        <!-- Loading Screen -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p style="margin-top: 1rem; color: var(--gray-700);">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö...</p>
        </div>

        <!-- Quiz Interface -->
        <div id="quizContainer" class="quiz-container">
            <!-- Quiz Header -->
            <div class="quiz-header">
                <div class="quiz-progress">
                    ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà <span id="currentQuestion">1</span> ‡∏à‡∏≤‡∏Å <span id="totalQuestionsDisplay">10</span>
                </div>
                <div class="timer" id="timer">
                    <span class="icon">‚è±Ô∏è</span>
                    <span id="timeRemaining">30:00</span>
                </div>
            </div>

            <!-- Question Container -->
            <div class="question-container">
                <div class="question-header">
                    <span class="question-number" id="questionNumber">Question 1</span>
                    <span class="question-type" id="questionType">Multiple Choice</span>
                    <span class="question-points" id="questionPoints">10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span>
                </div>

                <div class="question-text" id="questionText">
                    <!-- Question will be inserted here -->
                </div>

                <div class="answer-options" id="answerOptions">
                    <!-- Answer options will be inserted here -->
                </div>

                <!-- Question Navigator -->
                <div class="question-navigator">
                    <h3>üó∫Ô∏è ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£)</h3>
                    <div class="question-grid" id="questionGrid">
                        <!-- Question navigation buttons will be inserted here -->
                    </div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="quiz-navigation">
                <div class="nav-buttons">
                    <button class="btn btn-warning" id="prevBtn" onclick="previousQuestion()">‚Üê ‡∏Ç‡πâ‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</button>
                    <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">‡∏Ç‡πâ‡∏≠‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
                </div>
                <button class="btn btn-success" id="submitBtn" onclick="confirmSubmit()">‚úì ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</button>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="quizResults" class="quiz-results">
            <div class="results-header">
                <h2>üéâ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h2>
                <p style="color: var(--gray-700);">‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö: <span id="resultQuizName"></span></p>
            </div>

            <div class="score-display">
                <div class="score-circle">
                    <div class="score-number" id="scorePercentage">85%</div>
                    <div class="score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</div>
                </div>
            </div>

            <div style="text-align: center;">
                <div class="grade-badge" id="gradeBadge">A</div>
            </div>

            <div class="results-summary">
                <div class="summary-item">
                    <span class="summary-label">üë§ ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</span>
                    <span class="summary-value" id="resultStudentName">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">üÜî ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</span>
                    <span class="summary-value" id="resultStudentId">-</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">‚úÖ ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å</span>
                    <span class="summary-value" id="correctAnswers">8</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">‚ùå ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î</span>
                    <span class="summary-value" id="incorrectAnswers">2</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">üìä ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ</span>
                    <span class="summary-value"><span id="scoreObtained">85</span>/<span id="scorePossible">100</span></span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</span>
                    <span class="summary-value" id="timeUsed">25 ‡∏ô‡∏≤‡∏ó‡∏µ 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ</span>
                </div>
            </div>

            <div class="answer-review" id="answerReview">
                <h3 style="color: var(--darkblue); margin-bottom: 1rem;">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</h3>
                <!-- Answer review will be inserted here -->
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="location.reload()">üîÑ ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</button>
                <button class="btn btn-warning" onclick="window.location.href='819605-2-2568.html'">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="submitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span style="font-size: 2rem;">‚ö†Ô∏è</span>
                <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö</h3>
            </div>
            <div class="modal-body">
                <p>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö?</p>
                <p style="margin-top: 1rem;">
                    ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß <strong><span id="answeredCount">0</span></strong> ‡∏Ç‡πâ‡∏≠ 
                    ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <strong><span id="totalQuestionsModal">0</span></strong> ‡∏Ç‡πâ‡∏≠
                </p>
                <p style="margin-top: 1rem; color: var(--danger); font-weight: 600;">
                    ‡∏´‡∏≤‡∏Å‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å!
                </p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" onclick="closeSubmitModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-success" onclick="submitQuiz()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>¬© 2025 Southeast Asia University. All rights reserved.</p>
    </footer>

    <!-- External JavaScript -->
    <script src="assets/js/quiz-system.js"></script>
</body>
</html>
    let userAnswers = [];
    let timerInterval = null;
    let timeRemaining = 0;
    let quizStartTime = null;
    let studentInfo = {};
    let tabSwitchCount = 0, hasLeftPage = false;
    let devToolsInterval = null;

    document.addEventListener('DOMContentLoaded', async () => {
      await initializeQuizSelection();
    });

    async function loadQuizConfig() {
      const res = await fetch(QUIZ_CONFIG.quizDataPath + QUIZ_CONFIG.configFile);
      if (!res.ok) throw new Error('Failed to load quiz config: ' + res.status);
      const conf = await res.json();
      return conf.courses[QUIZ_CONFIG.courseCode];
    }

    async function initializeQuizSelection() {
      const quizSelect = document.getElementById('quizSelect');
      quizSelect.innerHTML = '<option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö --</option>';
      quizConfig = await loadQuizConfig();

      for (const q of quizConfig.quizzes) {
        if (!q.enabled) continue;
        const opt = document.createElement('option');
        opt.value = q.id;
        opt.textContent = q.displayName;
        quizSelect.appendChild(opt);
      }
    }

    document.getElementById('quizSelect').addEventListener('change', updateQuizInfo);

    async function updateQuizInfo() {
      const quizId = document.getElementById('quizSelect').value;
      const elQ = document.getElementById('totalQuestions');
      const elD = document.getElementById('quizDuration');
      const elT = document.getElementById('totalPoints');

      if (!quizId) { elQ.textContent = '-'; elD.textContent = '-'; elT.textContent='-'; return; }

      if (!quizData[quizId]) {
        elQ.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
        const qinfo = quizConfig.quizzes.find(q => q.id === quizId);
        const res = await fetch(QUIZ_CONFIG.quizDataPath + qinfo.file);
        if (!res.ok) { elQ.textContent = '-'; alert('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); return; }
        quizData[quizId] = await res.json();
      }

      const quiz = quizData[quizId];
      elQ.textContent = quiz.questions.length;
      elD.textContent = quiz.duration;
      elT.textContent = quiz.questions.reduce((s,q)=>s+q.points,0);
    }

    document.getElementById('studentForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const studentId = document.getElementById('studentId').value;
      const studentName = document.getElementById('studentName').value;
      const quizId = document.getElementById('quizSelect').value;

      if (!quizId || !quizData[quizId]) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö'); return; }

      studentInfo = { studentId, studentName, quizId };
      currentQuiz = quizData[quizId];
      userAnswers = new Array(currentQuiz.questions.length).fill(null);

      // show loading -> start
      document.getElementById('quizStart').style.display = 'none';
      document.getElementById('loading').classList.add('active');
      setTimeout(() => startQuiz(), 1000);
    });

    function startQuiz() {
      document.getElementById('loading').classList.remove('active');
      document.getElementById('quizContainer').classList.add('active');

      quizStartTime = new Date();
      timeRemaining = currentQuiz.duration * 60;
      startTimer();

      currentQuestionIndex = 0;
      displayQuestion();
      createQuestionNavigator();

      // anti-cheat counters
      tabSwitchCount = 0; hasLeftPage = false;
      devToolsInterval = setInterval(detectDevTools, 1000);
    }

    function startTimer() {
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();
        if (timeRemaining <= 300) document.getElementById('timer').classList.add('warning');
        if (timeRemaining <= 0) { clearInterval(timerInterval); alert('‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'); submitQuiz(); }
      }, 1000);
    }

    function updateTimerDisplay() {
      const m = Math.floor(timeRemaining/60), s = timeRemaining%60;
      document.getElementById('timeRemaining').textContent =
        `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function displayQuestion() {
      const q = currentQuiz.questions[currentQuestionIndex];
      document.getElementById('currentQuestion').textContent = currentQuestionIndex+1;
      document.getElementById('totalQuestionsDisplay').textContent = currentQuiz.questions.length;
      document.getElementById('questionNumber').textContent = `Question ${currentQuestionIndex+1}`;
      document.getElementById('questionType').textContent = q.type === 'multiple-choice' ? 'Multiple Choice' : 'Text Answer';
      document.getElementById('questionPoints').textContent = `${q.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`;
      document.getElementById('questionText').innerHTML = q.question;

      const options = document.getElementById('answerOptions');
      options.innerHTML = '';
      if (q.type === 'multiple-choice') {
        q.options.forEach((opt, idx) => {
          const div = document.createElement('div');
          div.className = 'answer-option' + (userAnswers[currentQuestionIndex]===idx?' selected':'');
          div.innerHTML = `
            <input type="radio" name="answer" id="option${idx}" value="${idx}" ${userAnswers[currentQuestionIndex]===idx?'checked':''}>
            <label for="option${idx}">${String.fromCharCode(65+idx)}. ${opt}</label>`;
          div.addEventListener('click', ()=>selectAnswer(idx));
          options.appendChild(div);
        });
      } else {
        const ta = document.createElement('textarea');
        ta.className = 'text-answer';
        ta.placeholder = '‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...';
        ta.value = userAnswers[currentQuestionIndex] || '';
        ta.addEventListener('input', function(){ userAnswers[currentQuestionIndex]=this.value; updateQuestionNavigator(); });
        options.appendChild(ta);
      }

      document.getElementById('prevBtn').disabled = currentQuestionIndex===0;
      document.getElementById('nextBtn').style.display = currentQuestionIndex===currentQuiz.questions.length-1 ? 'none' : 'inline-block';
      updateQuestionNavigator();
    }

    function selectAnswer(idx){
      userAnswers[currentQuestionIndex]=idx;
      document.querySelectorAll('.answer-option').forEach((el,i)=>{
        if(i===idx){ el.classList.add('selected'); el.querySelector('input').checked=true; }
        else{ el.classList.remove('selected'); }
      });
      updateQuestionNavigator();
    }

    function createQuestionNavigator() {
      const grid = document.getElementById('questionGrid');
      grid.innerHTML = '';
      currentQuiz.questions.forEach((_,i)=>{
        const b=document.createElement('button');
        b.type='button'; b.className='question-nav-btn'; b.textContent=i+1;
        b.onclick=()=>{ currentQuestionIndex=i; displayQuestion(); };
        grid.appendChild(b);
      });
      updateQuestionNavigator();
    }

    function updateQuestionNavigator(){
      document.querySelectorAll('.question-nav-btn').forEach((btn,i)=>{
        btn.classList.remove('current','answered');
        if(i===currentQuestionIndex) btn.classList.add('current');
        else if(userAnswers[i]!==null && userAnswers[i]!=='') btn.classList.add('answered');
      });
    }

    function previousQuestion(){ if(currentQuestionIndex>0){ currentQuestionIndex--; displayQuestion(); } }
    function nextQuestion(){ if(currentQuestionIndex<currentQuiz.questions.length-1){ currentQuestionIndex++; displayQuestion(); } }

    function confirmSubmit(){
      const answeredCount = userAnswers.filter(a=>a!==null && a!=='').length;
      document.getElementById('answeredCount').textContent = answeredCount;
      document.getElementById('totalQuestionsModal').textContent = currentQuiz.questions.length;
      document.getElementById('submitModal').classList.add('active');
    }
    function closeSubmitModal(){ document.getElementById('submitModal').classList.remove('active'); }

    function submitQuiz(){
      closeSubmitModal(); clearInterval(timerInterval);
      const end = new Date(); const usedMs = end - quizStartTime;
      const usedMin = Math.floor(usedMs/60000), usedSec = Math.floor((usedMs%60000)/1000);

      // client-side (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ) ‚Äî ‡πÅ‡∏ï‡πà "‡∏à‡∏£‡∏¥‡∏á" ‡∏à‡∏∞‡πÉ‡∏´‡πâ‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ï‡∏£‡∏ß‡∏à‡πÉ‡∏´‡∏°‡πà
      let correctCount=0, totalPoints=0, earned=0;
      currentQuiz.questions.forEach((q,i)=>{
        totalPoints += q.points;
        if(q.type==='multiple-choice' && userAnswers[i]===q.correctAnswer){ correctCount++; earned += q.points; }
      });
      const pct = Math.round((earned/totalPoints)*100);
      const grade = getGrade(pct);

      // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
      document.getElementById('quizContainer').classList.remove('active');
      document.getElementById('quizResults').classList.add('active');
      document.getElementById('resultQuizName').textContent = currentQuiz.title;
      document.getElementById('resultStudentName').textContent = studentInfo.studentName;
      document.getElementById('resultStudentId').textContent = studentInfo.studentId;
      document.getElementById('correctAnswers').textContent = correctCount;
      document.getElementById('incorrectAnswers').textContent = currentQuiz.questions.length - correctCount;
      document.getElementById('scoreObtained').textContent = earned;
      document.getElementById('scorePossible').textContent = totalPoints;
      document.getElementById('scorePercentage').textContent = pct + '%';
      document.getElementById('timeUsed').textContent = `${usedMin} ‡∏ô‡∏≤‡∏ó‡∏µ ${usedSec.toString().padStart(2,'0')} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;

      const gb = document.getElementById('gradeBadge');
      gb.textContent = grade; gb.className = 'grade-badge ' + getGradeClass(grade);

      displayAnswerReview();

      // ---------- ‡∏™‡∏£‡πâ‡∏≤‡∏á answers ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢ save ----------
      const answers = currentQuiz.questions.map((q, idx) => ({
        questionId: (q.id != null ? String(q.id) : `q${idx+1}`),
        question: q.question,
        userAnswer: userAnswers[idx],
        correctAnswer: (q.correctAnswer ?? null),
        isCorrect: (q.type === 'multiple-choice') && (userAnswers[idx] === q.correctAnswer),
        type: q.type
      }));

      saveResults({
        studentId: studentInfo.studentId,
        studentName: studentInfo.studentName,
        quizId: studentInfo.quizId,
        quizTitle: currentQuiz.title,
        score: earned,
        totalPoints: totalPoints,
        percentage: pct,
        grade: grade,
        timeUsed: `${usedMin}:${usedSec.toString().padStart(2,'0')}`,
        timestamp: new Date().toISOString(),
        answers // << ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÅ‡∏ô‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
      });
    }

    function displayAnswerReview(){
      const review = document.getElementById('answerReview');
      review.innerHTML = '<h3 style="color:#002147; margin-bottom:1rem;">üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</h3>';
      currentQuiz.questions.forEach((q,i)=>{
        const ua = userAnswers[i];
        const ok = (q.type==='multiple-choice') && (ua===q.correctAnswer);
        const div = document.createElement('div');
        div.className = `review-question ${ok?'correct':'incorrect'}`;
        const ansText = q.type==='multiple-choice' ? (ua!=null ? q.options[ua] : '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏≠‡∏ö') : (ua || '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏≠‡∏ö');
        div.innerHTML = `
          <div class="review-header">
            <strong>‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${i+1}</strong>
            <span class="review-status ${ok?'status-correct':'status-incorrect'}">${ok?'‚úì ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á':'‚úó ‡∏ú‡∏¥‡∏î'}</span>
          </div>
          <p><strong>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:</strong> ${q.question}</p>
          <p><strong>‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</strong> ${ansText}</p>
          ${q.type==='multiple-choice' ? `<p><strong>‡πÄ‡∏â‡∏•‡∏¢:</strong> ${q.options[q.correctAnswer]}</p>`:''}
          ${q.explanation ? `<p style="color:#495057"><strong>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢:</strong> ${q.explanation}</p>`:''}
        `;
        review.appendChild(div);
      });
    }

    function getGrade(p){ 
        if(p>=80) return 'A'; 
        if(p>=70) return 'B'; 
        if(p>=60) return 'C'; 
        if(p>=50) return 'D'; 
        return 'F'; 
    }
    function getGradeClass(g){ 
        return 'grade-'+g.toLowerCase(); 
    }

    async function saveResults(results){
      // local backup
      try{
        const all = JSON.parse(localStorage.getItem('quizResults') || '[]');
        all.push(results);
        localStorage.setItem('quizResults', JSON.stringify(all));
      }catch(e){ console.warn('LocalStorage backup failed', e); }

      try{
        // fallback ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ results.answers ‡∏Å‡πá‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å currentQuiz + userAnswers
        const safeAnswers = Array.isArray(results.answers) && results.answers.length === currentQuiz.questions.length
          ? results.answers
          : currentQuiz.questions.map((q, idx) => ({
              questionId: (q.id != null ? String(q.id) : `q${idx+1}`),
              userAnswer: userAnswers[idx] ?? null
            }));

        const payload = {
          studentId: studentInfo.studentId,
          studentName: studentInfo.studentName,
          quizId: studentInfo.quizId,
          quizTitle: currentQuiz.title,
          timeUsedSec: (new Date() - quizStartTime)/1000,
          answers: safeAnswers.map((a, idx)=>{
            const q = currentQuiz.questions[idx];
            return {
              questionId: a.questionId,
              userAnswer: (q.type==='multiple-choice')
                ? (a.userAnswer===null || a.userAnswer==='' ? null : Number(a.userAnswer))
                : null
            };
          }),
          clientMeta: {
            clientReported: {
              score: results.score,
              totalPoints: results.totalPoints,
              percentage: results.percentage,
              grade: results.grade
            },
            tabSwitchCount,
            userAgent: navigator.userAgent
          }
        };

        const resp = await fetch(APP_SCRIPT_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });

        const data = await resp.json();
        if(!data.ok){
          console.warn('Server rejected submission:', data);
          showSoftWarning('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô');
          return;
        }

        // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏ù‡∏±‡πà‡∏á‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå (truth)
        document.getElementById('correctAnswers').textContent = data.computed.correct;
        document.getElementById('incorrectAnswers').textContent = data.computed.incorrect;
        document.getElementById('scoreObtained').textContent = data.computed.score;
        document.getElementById('scorePossible').textContent = data.computed.totalPoints;
        document.getElementById('scorePercentage').textContent = data.computed.percentage + '%';
        const gb = document.getElementById('gradeBadge');
        gb.textContent = data.computed.grade;
        gb.className = 'grade-badge ' + getGradeClass(data.computed.grade);

        const okDiv = document.createElement('div');
        okDiv.className='alert alert-info';
        okDiv.innerHTML = `<span style="font-size:1.5rem;">‚úÖ</span><div><strong>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong> ‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>`;
        document.getElementById('quizResults').prepend(okDiv);

      }catch(err){
        console.error('Submit error:', err);
        showSoftWarning('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß');
      }
    }

    function showSoftWarning(msg){
      const d=document.createElement('div');
      d.className='alert alert-info';
      d.style.backgroundColor='#fff3cd'; d.style.borderColor='#ffc107';
      d.innerHTML = `<span style="font-size:1.5rem;">‚ö†Ô∏è</span><div>${msg}</div>`;
      document.getElementById('quizResults').prepend(d);
    }

    // ===================== Anti-cheat (‡∏ï‡∏±‡∏î‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏¥‡∏°) =====================
    document.addEventListener('visibilitychange', function(){
      if (!document.getElementById('quizContainer').classList.contains('active')) return;
      if (document.hidden) {
        tabSwitchCount++; hasLeftPage = true;
        if (tabSwitchCount >= 2) { alert('‚ö†Ô∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ó‡πá‡∏ö‡∏ö‡πà‡∏≠‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'); autoSubmitQuiz('Tab switching detected'); }
        else { alert(`‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! (${tabSwitchCount}/2) ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏Ç‡∏ì‡∏∞‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö`); }
      }
    });

    window.addEventListener('blur', function(){
      if (!document.getElementById('quizContainer').classList.contains('active')) return;
      tabSwitchCount++; hasLeftPage = true;
      if (tabSwitchCount >= 2) { alert('‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°/‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ö‡πà‡∏≠‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥'); autoSubmitQuiz('Window focus lost'); }
      else { alert(`‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô! (${tabSwitchCount}/2)`); }
    });

    function detectDevTools(){
      const th=160;
      if (window.outerWidth - window.innerWidth > th || window.outerHeight - window.innerHeight > th) {
        if (document.getElementById('quizContainer').classList.contains('active')) {
          alert('‚ö†Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö Developer Tools ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥');
          autoSubmitQuiz('Developer tools detected');
        }
      }
    }

    function autoSubmitQuiz(reason){
      if (timerInterval) clearInterval(timerInterval);
      if (devToolsInterval) clearInterval(devToolsInterval);
      try{ closeSubmitModal(); }catch(_){}
      submitQuiz();
      setTimeout(()=>{
        const results = document.getElementById('quizResults');
        const w = document.createElement('div');
        w.className='alert alert-warning';
        w.innerHTML = `<span style="font-size:1.5rem;">‚ö†Ô∏è</span>
          <div><strong>‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</strong><br>‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•: ${reason}</div>`;
        results.prepend(w);
      },100);
    }

    document.addEventListener('copy', e=>{ if(document.getElementById('quizContainer').classList.contains('active')){ e.preventDefault(); alert('‚ö†Ô∏è ‡∏´‡πâ‡∏≤‡∏°‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö'); }});
    document.addEventListener('paste', e=>{ if(document.getElementById('quizContainer').classList.contains('active')){ e.preventDefault(); alert('‚ö†Ô∏è ‡∏´‡πâ‡∏≤‡∏°‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö'); }});
    document.addEventListener('cut',   e=>{ if(document.getElementById('quizContainer').classList.contains('active')){ e.preventDefault(); alert('‚ö†Ô∏è ‡∏´‡πâ‡∏≤‡∏°‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≥‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö'); }});
    window.addEventListener('beforeunload', e=>{ if(document.getElementById('quizContainer').classList.contains('active')){ e.preventDefault(); e.returnValue=''; }});
    document.addEventListener('contextmenu', e=>{ if(document.getElementById('quizContainer').classList.contains('active')) e.preventDefault(); });

    function getGradeClass(g){ return 'grade-'+g.toLowerCase(); }
  </script>
</body>
</html>